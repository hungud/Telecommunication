CREATE TABLE CRM_TYPE_REQUEST(
  TYPE_REQUEST_ID INTEGER,
  TYPE_NAME       VARCHAR2(30 CHAR)
);

CREATE UNIQUE INDEX PK_CRM_TYPE_REQUEST ON CRM_TYPE_REQUEST(TYPE_REQUEST_ID);

ALTER TABLE CRM_TYPE_REQUEST ADD (
  CONSTRAINT PK_CRM_TYPE_REQUEST
  PRIMARY KEY
  (TYPE_REQUEST_ID)
  USING INDEX PK_CRM_TYPE_REQUEST);

ALTER TABLE CRM_TYPE_REQUEST ADD (TEXT_SMS VARCHAR2(512 CHAR));
ALTER TABLE CRM_TYPE_REQUEST DROP COLUMN TEXT_SMS;

ALTER TABLE CRM_TYPE_REQUEST ADD (TEXT_SMS_OPEN VARCHAR2(512 CHAR));
ALTER TABLE CRM_TYPE_REQUEST ADD (TEXT_SMS_CLOSE VARCHAR2(512 CHAR));

GRANT SELECT, INSERT, DELETE, UPDATE ON CRM_TYPE_REQUEST TO CRM_USER;
CREATE SYNONYM CRM_USER.TYPE_REQUEST FOR CRM_TYPE_REQUEST;

CREATE SEQUENCE S_TYPE_REQUEST;

CREATE OR REPLACE TRIGGER TIU_CRM_TYPE_REQUEST
  BEFORE INSERT OR UPDATE ON CRM_TYPE_REQUEST FOR EACH ROW
--#Version=1
BEGIN
  IF INSERTING THEN
    IF NVL(:NEW.TYPE_REQUEST_ID, 0) = 0 then
      :NEW.TYPE_REQUEST_ID := S_TYPE_REQUEST.NEXTVAL;
    END IF;
  END IF;
END;
CREATE SYNONYM CRM_USER.S_TYPE_REQUEST FOR S_TYPE_REQUEST;
grant select on S_TYPE_REQUEST to CRM_USER; 

alter table CRM_TYPE_REQUEST add (
  order_position integer,
  is_active integer
);

COMMENT ON COLUMN CRM_TYPE_REQUEST.ORDER_POSITION IS 'Порядковый номер типа для отображения в списках';
COMMENT ON COLUMN CRM_TYPE_REQUEST.IS_ACTIVE IS 'Признак определяющий активный тип или нет. 1 - активный; 0 - неактивный';

ALTER TABLE CRM_TYPE_REQUEST
MODIFY(TYPE_NAME VARCHAR2(100 CHAR))

CREATE SYNONYM USER_1C.TYPE_REQUEST FOR CRM_TYPE_REQUEST;
GRANT SELECT ON CRM_TYPE_REQUEST TO USER_1C;
SET DEFINE OFF;
Insert into CRM_TYPE_REQUEST
   (TYPE_REQUEST_ID, TYPE_NAME, TEXT_SMS_OPEN, TEXT_SMS_CLOSE, POLLING_TEXT, 
    ORDER_POSITION, IS_ACTIVE)
 Values
   (221, 'Автоматическое пополнение', NULL, NULL, NULL, 
    NULL, NULL);
COMMIT;
